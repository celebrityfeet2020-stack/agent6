# M3 Agent 指挥中心操作手册

**版本**: v1.5  
**日期**: 2025-12-03  
**作者**: Manus AI

---

## 1. 系统概述

M3 Agent 指挥中心（Command Interface）是专为高阶用户设计的战术级控制台。它摒弃了传统的聊天软件布局，采用垂直分屏的 IDE 风格，旨在提供全方位的信息掌控能力。

本系统核心设计理念为 **"透明化 (Transparency)"** 与 **"无感交互 (Seamless Interaction)"**，让您不仅能与 Agent 对话，更能实时洞察其思维过程与系统状态。

---

## 2. 界面布局详解

系统界面分为三大核心区域，支持动态调整：

### 2.1 顶部状态栏 (Header)
位于页面最上方，提供全局状态监控与快捷操作。

*   **系统状态指示灯**：左侧绿色脉冲点，表示系统在线。
*   **同步时间**：显示最近一次与后端 API 同步的时间戳。
*   **快捷指令区 (Quick Actions)**：
    *   `🔄 重置记忆`：清除 Agent 的短期记忆，开启新话题。
    *   `📈 查看状态`：检查后端服务健康度与 Token 消耗。
    *   `🗑️ 清空上下文`：清空当前屏幕上的对话历史（不影响后端记忆）。
*   **连接控制**：
    *   `Wi-Fi 图标`：切换实时同步开关（开启/静默）。
    *   `刷新图标`：强制重载页面 UI。

### 2.2 监控面板 (Top Panel)
位于屏幕上半部分，默认占比 40%，支持通过中间的分隔条上下拖拽调整高度。

*   **混合流视图**：将系统日志、思维链 (CoT)、工具调用融合在同一时间轴。
*   **智能筛选**：点击右上角 `筛选` 按钮，可过滤显示：
    *   🧠 **思维链 (Thought)**：紫色高亮，显示 Agent 的规划与推理。
    *   🔧 **工具调用 (Tool)**：橙色高亮，显示搜索、RPA 等工具的参数与结果。
    *   ℹ️ **系统日志 (System)**：显示初始化、连接状态等底层信息。
    *   🚫 **错误信息 (Error)**：红色高亮，显示异常堆栈。

### 2.3 对话与指令舱 (Bottom Panel)
位于屏幕下半部分，是核心交互区域。

*   **对话流**：显示您与 Agent (Qwen3-30B) 以及 API (Kori-API) 的多方对话。
*   **增强型输入框**：
    *   **无感上传**：支持直接 `Ctrl+V` 粘贴截图，或将文件拖拽进输入框。
    *   **文件预览**：上传的文件会在输入框上方显示缩略图（支持图片、音频、文档）。
    *   **多模态反馈**：发送成功、出错或删除文件时，会有微妙的机械音效反馈。

---

## 3. 交互指南

### 3.1 发送指令
在底部输入框输入自然语言指令，按 `Enter` 发送（`Shift+Enter` 换行）。

### 3.2 文件处理
系统支持多模态输入，但会自动拦截不支持的格式：
*   ✅ **支持**：图片 (.jpg, .png), 文档 (.pdf, .txt, .md), 音频 (.mp3, .wav)
*   ❌ **拦截**：视频文件（系统会自动提示不支持）

### 3.3 调整视图
*   **专注模式**：将中间的分隔条向上拖动至顶部，隐藏日志面板，最大化对话窗口。
*   **调试模式**：将分隔条向下拖动，最大化日志面板，详细审查 Agent 的每一步思考。

---

## 4. 后端对接建议 (致开发者)

为了充分发挥本 UI 的潜力，建议后端进行以下适配：

1.  **SSE 流式输出**：
    请确保后端 API 支持 Server-Sent Events (SSE)，并按照以下格式推送日志事件，以便前端正确渲染颜色与图标：
    ```json
    {
      "type": "thought", // 或 "tool", "system", "error"
      "content": "正在规划下一步...",
      "timestamp": "10:00:01"
    }
    ```

2.  **记忆持久化**：
    前端已移除本地日志保存功能，请确保后端 D5 记忆模块能定期将关键交互归档存储。

3.  **角色区分**：
    在推送消息时，请在 metadata 中区分 `source: 'user'` 或 `source: 'api'`，以便前端正确显示 "Kori" 或 "Kori-API" 的头像与名称。

---

**M3 Agent Team**  
*Building the Future of AI Interaction*
